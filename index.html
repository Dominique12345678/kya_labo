<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>KYA-Analyser</title>
        <script src="https://cdn.tailwindcss.com/"></script>
        <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
        <link rel="stylesheet" href="style.css" />
        <style>
            .sticky-header th {
                position: sticky;
                top: 0;
                z-index: 20;
            }
            .sticky-col-1 {
                position: sticky;
                left: 0;
                z-index: 10;
                background-color: white;
            }
            .sticky-col-2 {
                position: sticky;
                left: 48px;
                z-index: 10;
                background-color: white;
            }
            .sticky-header .sticky-col-1,
            .sticky-header .sticky-col-2 {
                z-index: 30;
            }
        </style>
    </head>
    <body class="bg-stone-100">
        <nav class="bg-white border-b border-stone-300 px-8 py-4">
            <div class="flex items-center gap-4 max-w-6xl mx-auto">
                <a
                    href="#"
                    data-page="home"
                    class="flex items-center gap-3 cursor-pointer nav-link"
                >
                    <img
                        src="assets/logo.png"
                        alt="KYA-Energy Group Logo"
                        class="h-10 w-10"
                    />
                    <h1 class="text-xl font-semibold text-stone-800">
                        KYA-Analyser
                    </h1>
                </a>
                <div class="flex items-center gap-4 ml-auto">
                    <a
                        href="#"
                        data-page="configuration"
                        class="nav-link bg-emerald-700 text-white border-stone-600 hover:bg-stone-700 focus:bg-amber-700 rounded-full px-6 py-2 text-sm font-medium"
                        data-i18n="configTitle"
                        >Configuration</a
                    >
                    <a
                        href="#"
                        data-page="datalogger"
                        class="nav-link bg-emerald-700 text-white border-stone-600 hover:bg-stone-700 focus:bg-amber-700 rounded-full px-6 py-2 text-sm font-medium"
                        >Datalogger</a
                    >
                    <a
                        href="#"
                        data-page="technical"
                        class="nav-link bg-emerald-700 text-white border-stone-600 hover:bg-stone-700 focus:bg-amber-700 rounded-full px-6 py-2 text-sm font-medium"
                        >Technical Information</a
                    >
                    <div class="flex gap-2">
                        <button
                            id="lang-en"
                            class="px-3 py-1 text-sm font-medium rounded-md opacity-50 border bg-gray-200"
                        >
                            EN
                        </button>
                        <button
                            id="lang-fr"
                            class="px-3 py-1 text-sm font-medium rounded-md border border-emerald-700 text-white bg-emerald-700"
                        >
                            FR
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <div id="app-root"></div>

        <script src="https://unpkg.com/lucide@latest"></script>
        <script>
            const translations = {
                en: {
                    welcome: "Welcome to KYA-Analyser",
                    about: "About",
                    "phase-caracteristic-analyser":
                        "Mono-phase or Three-phase grid characteristic analyser",
                    ease: "Compact, precise & easy to use.",
                    "user-manual": "Download User Manual",
                    memory: "memory",
                    save: "Save",
                    dateTime: "Date and Time",
                    sendingInterval: "Sending Interval",
                    responseFromServer: "Server response:",
                    error: "Error:",
                    invalidFormat:
                        "Invalid format or date. Please enter in format: YYYY:MM:DD, HH:MM:SS",
                    validDate: "Valid date and time: {{dateTime}}",
                    activeSessions: "Active Sessions",
                    totalRecords: "Total Records",
                    avgPower: "Average Power",
                    lastUpdate: "Last Update",
                    configTitle: "System Configuration",
                },
                fr: {
                    welcome: "Bienvenue sur KYA-Analyser",
                    about: "À Propos de",
                    "phase-caracteristic-analyser":
                        "Analyseur de caractéristiques de réseau monophasé ou triphasé",
                    ease: "Compact, précis et facile à utiliser.",
                    "user-manual": "Télécharger le Manuel de l'Utilisateur",
                    memory: "de mémoire",
                    save: "Enregistrer",
                    dateTime: "Date et Heure",
                    sendingInterval: "Intervalle d'envoi",
                    responseFromServer: "Réponse du serveur :",
                    error: "Erreur :",
                    invalidFormat:
                        "Format invalide ou date non valide. Veuillez saisir au format : YYYY:MM:DD, HH:MM:SS",
                    validDate: "Date et heure valides : {{dateTime}}",
                    activeSessions: "Sessions actives",
                    totalRecords: "Nombre total d'enregistrements",
                    avgPower: "Puissance moyenne",
                    lastUpdate: "Dernière mise à jour",
                    configTitle: "Configuration du système",
                },
            };

            let currentLang = "fr";

            function t(key) {
                return translations[currentLang][key] || key;
            }

            const pageContents = {
                home: () => `
                <main class="p-8 min-h-screen">
                    <div class="max-w-6xl mx-auto mt-8">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                            <div class="space-y-6">
                                <div class="bg-white/80 backdrop-blur-sm shadow-lg border-1 border-stone-300 rounded-xl p-6">
                                    <div class="flex items-center gap-3">
                                        <div class="space-y-4">
                                            <h1 class="text-5xl font-bold text-stone-800 leading-tight" data-i18n-html="about"><br>KYA-Analyser</h1>
                                            <div class="mt-8 space-y-2 space-x-4">
                                                <p class="text-xl text-stone-700 font-medium" data-i18n="phase-caracteristic-analyser"></p>
                                                <p class="text-lg text-stone-600" data-i18n="ease"></p>
                                            </div>
                                        </div>
                                    </div>
                                    <button id="download-manual" class="mt-8 bg-gradient-to-r from-emerald-500 to-emerald-700 hover:from-teal-500 hover:to-teal-700 text-white px-12 py-6 text-lg font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 flex items-center">
                                        <i data-lucide="download" class="mr-3 h-5 w-5"></i><span data-i18n="user-manual"></span>
                                    </button>
                                </div>
                                <div class="grid grid-cols-2 gap-6 pt-8">
                                    <div class="flex items-center gap-4"><div class="p-3 bg-white rounded-lg border border-stone-300"><i data-lucide="briefcase" class="h-6 w-6 text-stone-600"></i></div><div><h3 class="font-semibold text-stone-800">Lightweight</h3><p class="text-stone-600">& portable</p></div></div>
                                    <div class="flex items-center gap-4"><div class="p-3 bg-white rounded-lg border border-stone-300"><i data-lucide="zap" class="h-6 w-6 text-stone-600"></i></div><div><h3 class="font-semibold text-stone-800">5 V power</h3><p class="text-stone-600">supply</p></div></div>
                                    <div class="flex items-center gap-4"><div class="p-3 bg-white rounded-lg border border-stone-300"><i data-lucide="hard-drive" class="h-6 w-6 text-stone-600"></i></div><div><h3 class="font-semibold text-stone-800">16 GB <span data-i18n="memory"></span></h3></div></div>
                                </div>
                            </div>
                            <div class="flex justify-center lg:justify-end"><div class="relative"><img src="assets/electrical-datalogger.png" alt="KYA-Analyser image" class="w-full h-full object-contain rounded-3xl border-2 border-stone-300 shadow-lg p-2 bg-white"></div></div>
                        </div>
                    </div>
                </main>
            `,
                technical: () => `
                <main class="p-8 min-h-screen">
                    <div class="max-w-6xl mx-auto mt-8">
                        <div><h1 class="text-4xl font-bold text-stone-800 mb-2">Technical Information</h1><p class="text-xl text-stone-700">Three phases KYA-Analyser</p></div>
                        <div class="flex items-center justify-between mb-8 mt-8">
                            <h2 class="text-2xl font-semibold text-stone-800">Grid Characteristic</h2>
                            <button id="download-sheet" class="bg-gradient-to-r from-emerald-500 to-emerald-700 hover:from-teal-500 hover:to-teal-700 text-white px-12 py-6 text-lg font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 flex items-center">
                                <i data-lucide="download" class="mr-3 h-5 w-5"></i>Download Technical Sheet
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-white/80 backdrop-blur-sm border-0 shadow-lg rounded-xl p-6"><div class="flex items-center gap-3"><div class="p-2 bg-blue-100 rounded-lg"><i data-lucide="plug" class="h-5 w-5 text-blue-600"></i></div><h3 class="text-xl font-semibold text-stone-800">Power Supply</h3></div><p class="mt-6 ml-6 text-2xl font-bold text-stone-800">5 V / 2 A</p></div>
                            <div class="bg-white/80 backdrop-blur-sm border-0 shadow-lg rounded-xl p-6"><div class="flex items-center gap-3"><div class="p-2 bg-green-100 rounded-lg"><i data-lucide="battery" class="h-5 w-5 text-green-600"></i></div><h3 class="text-xl font-semibold text-stone-800">Emergency Power</h3></div><p class="mt-6 ml-6 text-2xl font-bold text-stone-800">3×3,7 VDC 10000 mAh</p></div>
                            <div class="bg-white/80 backdrop-blur-sm border-0 shadow-lg rounded-xl p-6"><div class="flex items-center gap-3"><div class="p-2 bg-purple-100 rounded-lg"><i data-lucide="grid-3x3" class="h-5 w-5 text-purple-600"></i></div><h3 class="text-xl font-semibold text-stone-800">Network Info:</h3></div><div class="mt-6 space-y-3"><div class="flex justify-between items-center"><span class="text-stone-700 font-medium">Voltage:</span><span class="text-stone-800 font-semibold">80-260 VAC</span></div><div class="flex justify-between items-center"><span class="text-stone-700 font-medium">Current:</span><span class="text-stone-800 font-semibold">0-100 A</span></div><div class="flex justify-between items-center"><span class="text-stone-700 font-medium">Active Power:</span><span class="text-stone-800 font-semibold">0-23 kW</span></div><div class="flex justify-between items-center"><span class="text-stone-700 font-medium">Frequency:</span><span class="text-stone-800 font-semibold">45-65 Hz</span></div><div class="flex justify-between items-center"><span class="text-stone-700 font-medium">Power Factor:</span><span class="text-stone-800 font-semibold">0-1</span></div></div></div>
                        </div>
                        <div class="text-xl font-bold text-stone-700 mt-8">Relative error related to measurements: 0.5% - 1%</div>
                    </div>
                </main>
            `,
                configuration: () => `
                <main class="p-8 min-h-screen">
                    <div class="max-w-4xl mx-auto mt-8">
                        <div class="text-center mb-12"><div class="inline-flex items-center gap-3 mb-4"><div class="p-3 bg-gradient-to-r from-emerald-500 to-emerald-700 rounded-xl shadow-lg"><i data-lucide="settings" class="h-8 w-8 text-white"></i></div><div><h1 class="text-4xl font-bold text-stone-800">KYA-Analyser</h1><p class="text-xl text-stone-600 font-medium" data-i18n="configTitle"></p></div></div><div class="w-24 h-1 bg-gradient-to-r from-emerald-400 to-emerald-600 rounded-full mx-auto"></div></div>
                        <div class="grid gap-8">
                            <div class="bg-white/80 backdrop-blur-sm border-0 shadow-xl rounded-xl"><div class="p-6 pb-6"><div class="flex items-center gap-3"><div class="p-2 bg-gradient-to-r from-emerald-500 to-emerald-700 rounded-lg"><i data-lucide="calendar" class="h-5 w-5 text-white"></i></div><div><h2 class="text-2xl text-stone-800 font-semibold" data-i18n="dateTime"></h2><p class="text-stone-600 mt-1">Set the system date and time for accurate data logging</p></div></div></div><div class="p-6 pt-0 space-y-6"><div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="space-y-3"><label for="date" class="text-sm font-semibold text-stone-700 flex items-center gap-2"><i data-lucide="calendar" class="h-4 w-4"></i>Date</label><input id="date" type="date" class="h-12 border-stone-300 focus:border-teal-500 focus:ring-teal-500 rounded-xl w-full p-2 border"></div><div class="space-y-3"><label for="time" class="text-sm font-semibold text-stone-700 flex items-center gap-2"><i data-lucide="clock" class="h-4 w-4"></i>Time</label><input id="time" type="time" step="1" class="h-12 border-stone-300 focus:border-teal-500 focus:ring-teal-500 rounded-xl w-full p-2 border"></div></div></div></div>
                            <div class="bg-white/80 backdrop-blur-sm border-0 shadow-xl rounded-xl"><div class="p-6 pb-6"><div class="flex items-center gap-3"><div class="p-2 bg-gradient-to-r from-emerald-500 to-emerald-700 rounded-lg"><i data-lucide="zap" class="h-5 w-5 text-white"></i></div><div><h2 class="text-2xl text-stone-800 font-semibold" data-i18n="sendingInterval"></h2><p class="text-stone-600 mt-1">Configure the data sampling rate in seconds</p></div></div></div><div class="p-6 pt-0 space-y-6"><div class="max-w-xs"><label for="sampling" class="text-sm font-semibold text-stone-700 flex items-center gap-2 mb-3"><i data-lucide="zap" class="h-4 w-4"></i>Sampling Rate (seconds)</label><div class="relative"><input id="sampling" type="number" min="1" max="3600" placeholder="Enter seconds" class="h-12 border-stone-300 focus:border-teal-500 focus:ring-teal-500 rounded-xl pr-16 w-full p-2 border"><span class="absolute right-4 top-1/2 transform -translate-y-1/2 text-stone-500 text-sm font-medium">sec</span></div></div><div class="bg-purple-50 border border-purple-200 rounded-xl p-4"><p class="text-sm text-purple-800"><strong>Recommended:</strong> 1-60 seconds for most applications. Higher values reduce data storage requirements.</p></div></div></div>
                        </div>
                        <div class="flex justify-center mt-12"><button id="save-config" class="bg-gradient-to-r from-emerald-500 to-emerald-700 hover:from-teal-500 hover:to-teal-700 text-white px-12 py-4 text-lg font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all duration-200 transform hover:scale-105 flex items-center"><i data-lucide="save" class="mr-3 h-5 w-5"></i><span data-i18n="save"></span></button></div>
                    </div>
                </main>
            `,
                datalogger: () => `
                <main class="p-8 min-h-screen">
                    <div class="max-w-7xl mx-auto mt-8">
                        <div class="text-center mb-8"><div class="inline-flex items-center gap-3 mb-4"><div class="p-3 bg-gradient-to-r from-emerald-500 to-emerald-600 rounded-xl shadow-lg"><i data-lucide="database" class="h-8 w-8 text-white"></i></div><div><h1 class="text-4xl font-bold text-stone-800">KYA-Analyser Datalogger</h1><p class="text-xl text-stone-600 font-medium">Manage Data</p></div></div><div class="w-24 h-1 bg-gradient-to-r from-emerald-500 to-emerald-600 rounded-full mx-auto"></div></div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div class="bg-white/80 backdrop-blur-sm border-0 shadow-lg rounded-xl p-6"><div class="flex items-center gap-3"><div class="p-2 bg-blue-100 rounded-lg"><i data-lucide="file-text" class="h-5 w-5 text-blue-600"></i></div><div><p class="text-sm text-stone-600" data-i18n="totalRecords"></p><p id="total-records" class="text-2xl font-bold text-stone-800">0</p></div></div></div>
                            <div class="bg-white/80 backdrop-blur-sm border-0 shadow-lg rounded-xl p-6"><div class="flex items-center gap-3"><div class="p-2 bg-green-100 rounded-lg"><i data-lucide="activity" class="h-5 w-5 text-green-600"></i></div><div><p class="text-sm text-stone-600" data-i18n="activeSessions"></p><p class="text-2xl font-bold text-stone-800">3</p></div></div></div>
                            <div class="bg-white/80 backdrop-blur-sm border-0 shadow-lg rounded-xl p-6"><div class="flex items-center gap-3"><div class="p-2 bg-purple-100 rounded-lg"><i data-lucide="clock" class="h-5 w-5 text-purple-600"></i></div><div><p class="text-sm text-stone-600" data-i18n="lastUpdate"></p><p id="last-update" class="text-sm font-semibold text-stone-800">N/A</p></div></div></div>
                            <div class="bg-white/80 backdrop-blur-sm border-0 shadow-lg rounded-xl p-6"><div class="flex items-center gap-3"><div class="p-2 bg-orange-100 rounded-lg"><i data-lucide="zap" class="h-5 w-5 text-orange-600"></i></div><div><p class="text-sm text-stone-600" data-i18n="avgPower"></p><p class="text-2xl font-bold text-stone-800">2.8 kW</p></div></div></div>
                        </div>
                        <div class="flex justify-between items-center mb-6"><div class="flex items-center gap-4"><button id="select-all" class="border-stone-300 hover:bg-stone-100 bg-transparent px-4 py-2 rounded-md border">Select All</button><span id="selected-count-badge" class="hidden bg-emerald-100 text-emerald-800 text-xs font-medium px-2 py-0.5 rounded-md">0 selected</span></div><div class="flex gap-3"><button id="download-data" disabled class="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-2 rounded-xl shadow-lg flex items-center disabled:opacity-50 disabled:cursor-not-allowed"><i data-lucide="download" class="mr-2 h-4 w-4"></i>Download Data</button><button id="delete-selected" disabled class="bg-gradient-to-r from-red-500 to-red-600 text-white px-6 py-2 rounded-xl shadow-lg flex items-center disabled:opacity-50 disabled:cursor-not-allowed"><i data-lucide="trash-2" class="mr-2 h-4 w-4"></i>Delete Selected</button></div></div>
                        <div class="bg-white/90 backdrop-blur-sm border-0 shadow-xl rounded-lg"><div class="p-4"><div class="rounded-lg border border-stone-200 overflow-hidden"><div class="max-h-96 overflow-y-auto overflow-x-auto"><table class="w-full text-sm"><thead class="sticky-header bg-stone-50 border-b border-stone-200"><tr><th class="w-12 p-2 sticky-col-1 border-r"><input type="checkbox" id="select-all-checkbox" class="rounded border-stone-300"></th><th class="p-2 font-semibold text-left sticky-col-2 border-r min-w-[180px]">Timestamp</th><th class="p-2 font-semibold text-left bg-red-50 min-w-[120px]">AC_Voltage 1</th><th class="p-2 font-semibold text-left bg-red-50 min-w-[120px]">AC_Current 1</th><th class="p-2 font-semibold text-left bg-red-50 min-w-[100px]">Power 1</th><th class="p-2 font-semibold text-left bg-red-50 min-w-[100px]">Energy 1</th><th class="p-2 font-semibold text-left bg-red-50 min-w-[120px]">Frequency 1</th><th class="p-2 font-semibold text-left bg-red-50 min-w-[130px]">Power Factor 1</th><th class="p-2 font-semibold text-left bg-blue-50 min-w-[120px]">AC_Voltage 2</th><th class="p-2 font-semibold text-left bg-blue-50 min-w-[120px]">AC_Current 2</th><th class="p-2 font-semibold text-left bg-blue-50 min-w-[100px]">Power 2</th><th class="p-2 font-semibold text-left bg-blue-50 min-w-[100px]">Energy 2</th><th class="p-2 font-semibold text-left bg-blue-50 min-w-[120px]">Frequency 2</th><th class="p-2 font-semibold text-left bg-blue-50 min-w-[130px]">Power Factor 2</th><th class="p-2 font-semibold text-left bg-red-50 min-w-[120px]">AC_Voltage 3</th><th class="p-2 font-semibold text-left bg-red-50 min-w-[120px]">AC_Current 3</th><th class="p-2 font-semibold text-left bg-red-50 min-w-[100px]">Power 3</th><th class="p-2 font-semibold text-left bg-red-50 min-w-[100px]">Energy 3</th><th class="p-2 font-semibold text-left bg-red-50 min-w-[120px]">Frequency 3</th><th class="p-2 font-semibold text-left bg-red-50 min-w-[130px]">Power Factor 3</th></tr></thead><tbody id="table-body"></tbody></table></div></div></div></div>
                    </div>
                </main>
            `,
            };

            const appRoot = document.getElementById("app-root");
            const navLinks = document.querySelectorAll(".nav-link");
            const langEnBtn = document.getElementById("lang-en");
            const langFrBtn = document.getElementById("lang-fr");

            function updateTranslations() {
                document.querySelectorAll("[data-i18n]").forEach((el) => {
                    const key = el.getAttribute("data-i18n");
                    el.textContent = t(key);
                });
                document.querySelectorAll("[data-i18n-html]").forEach((el) => {
                    const key = el.getAttribute("data-i18n-html");
                    const baseHtml = el.innerHTML.split("</span>")[1] || "";
                    el.innerHTML = `${t(key)}${baseHtml}`;
                });
            }

            const pageScripts = {
                home: () => {
                    function handleDownload(linkF) {
                        const link = document.createElement("a");
                        link.href = linkF;
                        link.download = "user-manual.pdf";
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                    document
                        .getElementById("download-manual")
                        .addEventListener("click", () =>
                            handleDownload("logo_miam.pdf"),
                        );
                },
                technical: () => {
                    function handleDownload(linkF) {
                        const link = document.createElement("a");
                        link.href = linkF;
                        link.download = "technical-sheet.pdf";
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                    document
                        .getElementById("download-sheet")
                        .addEventListener("click", () =>
                            handleDownload("logo_miam.pdf"),
                        );
                },
                configuration: () => {
                    const dateInput = document.getElementById("date");
                    const timeInput = document.getElementById("time");
                    const samplingInput = document.getElementById("sampling");
                    const saveButton = document.getElementById("save-config");
                    saveButton.addEventListener("click", async (event) => {
                        event.preventDefault();
                        const date = dateInput.value;
                        const time = timeInput.value;
                        const sendingInterval = samplingInput.value;
                        const dateTime = `${date} ${time}`;
                        if (date && time) {
                            alert(
                                t("validDate").replace(
                                    "{{dateTime}}",
                                    dateTime,
                                ),
                            );
                            const mockResponse = `${t("responseFromServer")} ${t("validDate").replace("{{dateTime}}", dateTime)}, Interval: ${sendingInterval}s`;
                            alert(mockResponse);
                        } else {
                            alert(t("invalidFormat"));
                        }
                    });
                },
                datalogger: () => {
                    const tableBody = document.getElementById("table-body");
                    const totalRecordsEl =
                        document.getElementById("total-records");
                    const lastUpdateEl = document.getElementById("last-update");
                    const selectAllBtn = document.getElementById("select-all");
                    const selectAllCheckbox = document.getElementById(
                        "select-all-checkbox",
                    );
                    const downloadBtn =
                        document.getElementById("download-data");
                    const deleteBtn =
                        document.getElementById("delete-selected");
                    const selectedCountBadge = document.getElementById(
                        "selected-count-badge",
                    );
                    let data = [];
                    let selectedRows = new Set();
                    function renderTable() {
                        tableBody.innerHTML = "";
                        data.forEach((row, index) => {
                            const tr = document.createElement("tr");
                            tr.className = `hover:bg-stone-50 transition-colors ${selectedRows.has(index) ? "bg-emerald-50" : ""}`;
                            tr.dataset.index = index;
                            const createCell = (
                                content,
                                className = "",
                                isHeader = false,
                            ) => {
                                const cell = isHeader
                                    ? document.createElement("th")
                                    : document.createElement("td");
                                cell.className = `p-2 ${className}`;
                                cell.innerHTML = content;
                                return cell;
                            };
                            const checkbox = document.createElement("input");
                            checkbox.type = "checkbox";
                            checkbox.className = "rounded border-stone-300";
                            checkbox.checked = selectedRows.has(index);
                            checkbox.addEventListener("change", () =>
                                toggleRowSelection(index),
                            );
                            const th = createCell(
                                "",
                                "sticky-col-1 border-r",
                                true,
                            );
                            th.appendChild(checkbox);
                            tr.appendChild(th);
                            tr.appendChild(
                                createCell(
                                    row["Date-Heure"] || "",
                                    "font-mono text-sm sticky-col-2 border-r",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Tension_AC_1 (V)"] || "0.00",
                                    "bg-red-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Courant_AC_1 (A)"] || "0.00",
                                    "bg-red-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Power_1 (W)"] || "0.00",
                                    "bg-red-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Energie_1 (kWh)"] || "0.00",
                                    "bg-red-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Frequence_1 (Hz)"] || "0.00",
                                    "bg-red-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Facteur de puissance_1"] || "0.00",
                                    "bg-red-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Tension_AC_2 (V)"] || "0.00",
                                    "bg-blue-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Courant_AC_2 (A)"] || "0.00",
                                    "bg-blue-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Power_2 (W)"] || "0.00",
                                    "bg-blue-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Energie_2 (kWh)"] || "0.00",
                                    "bg-blue-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Frequence_2 (Hz)"] || "0.00",
                                    "bg-blue-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Facteur de puissance_2"] || "0.00",
                                    "bg-blue-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Tension_AC_3 (V)"] || "0.00",
                                    "bg-red-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Courant_AC_3 (A)"] || "0.00",
                                    "bg-red-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Power_3 (W)"] || "0.00",
                                    "bg-red-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Energie_3 (kWh)"] || "0.00",
                                    "bg-red-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Frequence_3 (Hz)"] || "0.00",
                                    "bg-red-50 font-semibold",
                                ),
                            );
                            tr.appendChild(
                                createCell(
                                    row["Facteur de puissance_3"] || "0.00",
                                    "bg-red-50 font-semibold",
                                ),
                            );
                            tableBody.appendChild(tr);
                        });
                        updateUI();
                    }
                    function updateUI() {
                        totalRecordsEl.textContent = data.length;
                        if (data.length > 0) {
                            lastUpdateEl.textContent =
                                data[data.length - 1]["Date-Heure"] || "N/A";
                        }
                        const hasSelection = selectedRows.size > 0;
                        downloadBtn.disabled = !hasSelection;
                        deleteBtn.disabled = !hasSelection;
                        if (hasSelection) {
                            selectedCountBadge.textContent = `${selectedRows.size} selected`;
                            selectedCountBadge.classList.remove("hidden");
                        } else {
                            selectedCountBadge.classList.add("hidden");
                        }
                        selectAllBtn.textContent =
                            selectedRows.size === data.length && data.length > 0
                                ? "Deselect All"
                                : "Select All";
                        selectAllCheckbox.checked =
                            selectedRows.size === data.length &&
                            data.length > 0;
                    }
                    function toggleRowSelection(index) {
                        if (selectedRows.has(index)) {
                            selectedRows.delete(index);
                        } else {
                            selectedRows.add(index);
                        }
                        renderTable();
                    }
                    function toggleSelectAll() {
                        if (selectedRows.size === data.length) {
                            selectedRows.clear();
                        } else {
                            selectedRows = new Set(data.map((_, i) => i));
                        }
                        renderTable();
                    }
                    selectAllBtn.addEventListener("click", toggleSelectAll);
                    selectAllCheckbox.addEventListener(
                        "change",
                        toggleSelectAll,
                    );
                    downloadBtn.addEventListener("click", () => {
                        if (selectedRows.size === 0) {
                            alert("Please select rows to download.");
                            return;
                        }
                        const selectedData = Array.from(selectedRows).map(
                            (index) => data[index],
                        );
                        const csv = Papa.unparse(selectedData, {
                            header: true,
                            quotes: true,
                            delimiter: ",",
                        });
                        const blob = new Blob([csv], {
                            type: "text/csv;charset=utf-8;",
                        });
                        const link = document.createElement("a");
                        const url = URL.createObjectURL(blob);
                        link.setAttribute("href", url);
                        link.setAttribute("download", "selected_data.csv");
                        link.style.visibility = "hidden";
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    });
                    deleteBtn.addEventListener("click", () => {
                        if (
                            confirm(
                                `Supprimer définitivement les ${selectedRows.size} lignes sélectionnées ?`,
                            )
                        ) {
                            alert(
                                `${selectedRows.size} lignes supprimées (simulation).`,
                            );
                            data = data.filter(
                                (_, index) => !selectedRows.has(index),
                            );
                            selectedRows.clear();
                            renderTable();
                        }
                    });
                    fetch("data.csv")
                        .then((response) => response.text())
                        .then((csvText) => {
                            Papa.parse(csvText, {
                                header: true,
                                skipEmptyLines: true,
                                complete: (results) => {
                                    data = results.data;
                                    renderTable();
                                },
                            });
                        });
                },
            };

            function navigate(page) {
                appRoot.innerHTML = pageContents[page]();
                lucide.createIcons();
                updateTranslations();
                if (pageScripts[page]) {
                    pageScripts[page]();
                }
            }

            function setLanguage(lang) {
                currentLang = lang;
                document.documentElement.lang = lang;
                langEnBtn.disabled = lang === "en";
                langFrBtn.disabled = lang === "fr";
                langEnBtn.classList.toggle("opacity-50", lang === "en");
                langFrBtn.classList.toggle("opacity-50", lang === "fr");
                langEnBtn.classList.toggle("bg-emerald-700", lang === "en");
                langFrBtn.classList.toggle("bg-emerald-700", lang === "fr");
                langEnBtn.classList.toggle("text-white", lang === "en");
                langFrBtn.classList.toggle("text-white", lang === "fr");
                updateTranslations();
            }

            navLinks.forEach((link) => {
                link.addEventListener("click", (e) => {
                    e.preventDefault();
                    const page = e.currentTarget.dataset.page;
                    navigate(page);
                });
            });

            langEnBtn.addEventListener("click", () => setLanguage("en"));
            langFrBtn.addEventListener("click", () => setLanguage("fr"));

            // Initial load
            navigate("home");
            setLanguage("fr");
        </script>
    </body>
</html>
